FROM quay.io/centos/centos:stream8
ENV GO111MODULE=on
ENV GOFLAGS=""
ENV VIRTUAL_ENV=/opt/venv
ENV GOPATH=/go
ENV PATH="$VIRTUAL_ENV/bin:$GOPATH/bin:$PATH"

COPY ./hack/setup_env.sh ./dev-requirements.txt ./ 
# Add docker repo to install docker-ce-cli to execute commands against the docker.socket
# Add epel to install p7zip and awscli
RUN dnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm && \
    dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo && \ 
    dnf -y update && \
    dnf -y install golang && \
    ./setup_env.sh assisted_service && \
    dnf clean all
COPY --from=quay.io/openshift/origin-cli:latest /usr/bin/oc /usr/bin
COPY --from=quay.io/operator-framework/upstream-opm-builder:v1.16.1 /bin/opm /bin