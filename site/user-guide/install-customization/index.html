<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Openshift Assisted Service Team">
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Assisted Installer Customization - Openshift Assisted Service</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Assisted Installer Customization";
    var mkdocs_page_input_path = "user-guide/install-customization.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Openshift Assisted Service</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">OAS Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">OAS Deployment</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../assisted-service-on-local/">OAS Running on Local</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../assisted-service-on-openshift/">OAS Running on Openshift</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Openshift Deployment</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="../user-guide.md">User Guide Index</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../deploy-on-local/">OCP Deployment on Local</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../deploy-on-bare-metal/">OCP Deployment on Bare Metal</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../deploy-on-vsphere/">OCP Deployment on vSphere</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../deploy-on-RHEV/">OCP Deployment on RHEV</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../deploy-on-OSP/">OCP Deployment on Openstack</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">OAS Development</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/migrations/">Migrations</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Openshift Assisted Service</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Assisted Installer Customization</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="assisted-installer-customization">Assisted Installer Customization</h1>
<h2 id="manifests">Manifests</h2>
<p>These APIs allows for adding arbitrary manifests to the set generated by <code>openshift-install create manifests</code>.
A typical use case would be to create a MachineConfig which would make some persistent customization to a group of nodes.
These will only take effect after the machine config operator is up and running so if a change is needed before or during the installation process, another API will be required.</p>
<h3 id="create-a-cluster-manifest">Create a cluster manifest</h3>
<pre><code># base64 encoding of the example from https://docs.openshift.com/container-platform/4.6/installing/install_config/installing-customizing.html 
content=YXBpVmVyc2lvbjogbWFjaGluZWNvbmZpZ3VyYXRpb24ub3BlbnNoaWZ0LmlvL3YxCmtpbmQ6IE1hY2hpbmVDb25maWcKbWV0YWRhdGE6CiAgbGFiZWxzOgogICAgbWFjaGluZWNvbmZpZ3VyYXRpb24ub3BlbnNoaWZ0LmlvL3JvbGU6IG1hc3RlcgogIG5hbWU6IDk5LW9wZW5zaGlmdC1tYWNoaW5lY29uZmlnLW1hc3Rlci1rYXJncwpzcGVjOgogIGtlcm5lbEFyZ3VtZW50czoKICAgIC0gJ2xvZ2xldmVsPTcnCg==
file=99-openshift-machineconfig-master-kargs.yaml
folder=openshift

curl \
    --header &quot;Content-Type: application/json&quot; \
    --header &quot;Authorization: Bearer $TOKEN&quot; \
    --request POST \
    --data &quot;{\&quot;file_name\&quot;:\&quot;$file\&quot;, \&quot;folder\&quot;:\&quot;$folder\&quot;, \&quot;content\&quot;:\&quot;$content\&quot;}&quot; \
&quot;http://$ASSISTED_SERVICE_IP:$ASSISTED_SERVICE_PORT/api/assisted-install/v1/clusters/$CLUSTER_ID/manifests&quot;
</code></pre>
<h3 id="view-a-manifests-contents">View a manifestâ€™s contents</h3>
<pre><code>file=openshift/99-openshift-machineconfig-master-kargs.yaml

curl --header &quot;Authorization: Bearer $TOKEN&quot; &quot;http://$ASSISTED_SERVICE_IP:$ASSISTED_SERVICE_PORT/api/assisted-install/v1/clusters/$CLUSTER_ID/manifests/files?file_name=$file&quot;
</code></pre>
<h2 id="discovery-ignition">Discovery Ignition</h2>
<p>The discovery ignition is used to make changes to the CoreOS live iso image which runs before we actually write anything to the target disk.
An example use case would be configuring a separate container registry to pull the assisted-installer-agent image from.</p>
<p>The discovery ignition must use version 3.1.0 regardless of the version of the cluster that will eventually be created.</p>
<h3 id="patch-the-discovery-ignition">Patch the discovery ignition</h3>
<pre><code># ignition patch file
{
  &quot;config&quot;: &quot;{\&quot;ignition\&quot;: {\&quot;version\&quot;: \&quot;3.1.0\&quot;}, \&quot;storage\&quot;: {\&quot;files\&quot;: [{\&quot;path\&quot;: \&quot;/etc/containers/registries.conf\&quot;, \&quot;mode\&quot;: 420, \&quot;overwrite\&quot;: true, \&quot;user\&quot;: { \&quot;name\&quot;: \&quot;root\&quot;},\&quot;contents\&quot;: {\&quot;source\&quot;: \&quot;data:text/plain;base64,dW5xdWFsaWZpZWQtc2VhcmNoLXJlZ2lzdHJpZXMgPSBbInJlZ2lzdHJ5LmFjY2Vzcy5yZWRoYXQuY29tIiwgImRvY2tlci5pbyJdCltbcmVnaXN0cnldXQogICBwcmVmaXggPSAiIgogICBsb2NhdGlvbiA9ICJxdWF5LmlvL29jcG1ldGFsIgogICBtaXJyb3ItYnktZGlnZXN0LW9ubHkgPSBmYWxzZQogICBbW3JlZ2lzdHJ5Lm1pcnJvcl1dCiAgIGxvY2F0aW9uID0gImxvY2FsLnJlZ2lzdHJ5OjUwMDAvb2NwbWV0YWwiCg==\&quot;}}]}}&quot;
}

curl \
    --header &quot;Content-Type: application/json&quot; \
    --header &quot;Authorization: Bearer $TOKEN&quot; \
    --request PATCH \
    --data @discovery-ign.json \
&quot;http://$ASSISTED_SERVICE_IP:$ASSISTED_SERVICE_PORT/api/assisted-install/v1/clusters/$CLUSTER_ID/discovery-ignition&quot;
</code></pre>
<h3 id="view-the-discovery-ignition">View the discovery ignition</h3>
<pre><code>curl --header &quot;Authorization: Bearer $TOKEN&quot; &quot;http://$ASSISTED_SERVICE_IP:$ASSISTED_SERVICE_PORT/api/assisted-install/v1/clusters/$CLUSTER_ID/discovery-ignition&quot;
</code></pre>
<h2 id="install-config">Install Config</h2>
<p>These endpoints alter the default install config yaml used when running <code>openshift-install create</code> commands.
Install config customization reference is available <a href="https://github.com/openshift/installer/blob/master/docs/user/customization.md">here</a>
Some of this content will be pinned to particular values, but most can be edited.
Note, some of this content will be pinned to particular values by the assisted-installer (can't be overwritten).</p>
<p>You can compose the install-config overrides by creating a json string with the options you wish to set.
An example install config with disabled hyperthreading for the control plane:</p>
<pre><code>apiVersion: v1
baseDomain: example.com
controlPlane:
  name: master
  hyperthreading: Disabled
compute:
- name: worker
  replicas: 5
metadata:
  name: test-cluster
platform: ...
pullSecret: '{&quot;auths&quot;: ...}'
sshKey: ssh-ed25519 AAAA...
</code></pre>
<p>should look like this:
<code>"{\"controlPlane\":{\"hyperthreading\":\"Disabled\"}}"</code></p>
<h3 id="patch-the-install-config">Patch the install config</h3>
<pre><code>curl \
    --header &quot;Content-Type: application/json&quot; \
    --header &quot;Authorization: Bearer $TOKEN&quot; \
    --request PATCH \
    --data '&quot;{\&quot;controlPlane\&quot;:{\&quot;hyperthreading\&quot;:\&quot;Disabled\&quot;}}&quot;' \
&quot;http://$ASSISTED_SERVICE_IP:$ASSISTED_SERVICE_PORT/api/assisted-install/v1/clusters/$CLUSTER_ID/install-config&quot;
</code></pre>
<h3 id="view-the-install-config">View the install config</h3>
<pre><code>curl --header &quot;Authorization: Bearer $TOKEN&quot; &quot;http://$ASSISTED_SERVICE_IP:$ASSISTED_SERVICE_PORT/api/assisted-install/v1/clusters/$CLUSTER_ID/install-config&quot;
</code></pre>
<h2 id="pointer-ignition">Pointer Ignition</h2>
<p>The pointer ignition is used to customize the particular host when it reboots into the installed system.
These changes will be made to the host, but will not be tracked as a machine config.
Generally a machine config will be a better fit than editing the pointer ignition, but if some change is specific to an individual host it would be made here.</p>
<p>The pointer ignition override version must match the version of the ignition generated by openshift-installer.
This means that the version required for the override will change depending on the cluster version being installed.</p>
<table>
<thead>
<tr>
<th>OCP Version(s)</th>
<th>Ignition version</th>
</tr>
</thead>
<tbody>
<tr>
<td>4.6</td>
<td>3.1.0</td>
</tr>
<tr>
<td>4.7, 4.8, 4.9, 4.10</td>
<td>3.2.0</td>
</tr>
</tbody>
</table>
<h3 id="patch-the-pointer-ignition">Patch the pointer ignition</h3>
<pre><code>curl \
    --header &quot;Content-Type: application/json&quot; \
    --header &quot;Authorization: Bearer $TOKEN&quot; \
    --request PATCH \
    --data '{&quot;config&quot;: &quot;{\&quot;ignition\&quot;: {\&quot;version\&quot;: \&quot;3.1.0\&quot;}, \&quot;storage\&quot;: {\&quot;files\&quot;: [{\&quot;path\&quot;: \&quot;/etc/example\&quot;, \&quot;contents\&quot;: {\&quot;source\&quot;: \&quot;data:text/plain;base64,SGVsbG8gZnJvbSBob3N0IDg0Njk2NzdiLThlZGEtNDQzOS1iNDQwLTc3ZGM5M2FkZmNlZgo=\&quot;}}]}}&quot;}' \
&quot;http://$ASSISTED_SERVICE_IP:$ASSISTED_SERVICE_PORT/api/assisted-install/v1/clusters/$CLUSTER_ID/hosts/$HOST_ID/ignition&quot;
</code></pre>
<h3 id="view-the-pointer-ignition">View the pointer ignition</h3>
<pre><code>curl --header &quot;Authorization: Bearer $TOKEN&quot; &quot;http://$ASSISTED_SERVICE_IP:$ASSISTED_SERVICE_PORT/api/assisted-install/v1/clusters/$CLUSTER_ID/hosts/$HOST_ID/ignition&quot;
</code></pre>
<h2 id="installer-params">Installer Params</h2>
<p>This endpoint sets parameters to be passed to the coreos-installer command line in addition to the ones we provide by default.
The only parameters that can be set with this endpoint are: ["--append-karg", "--delete-karg", "-n", "--copy-network", "--network-dir", "--save-partlabel", "--save-partindex", "--image-url"]</p>
<h3 id="set-the-installer-params">Set the installer params</h3>
<pre><code>curl \
    --header &quot;Content-Type: application/json&quot; \
    --header &quot;Authorization: Bearer $TOKEN&quot; \
    --request PATCH \
    --data '{&quot;args&quot;: [&quot;--append-karg&quot;, &quot;nameserver=8.8.8.8&quot;, &quot;-n&quot;]}' \
&quot;http://$ASSISTED_SERVICE_IP:$ASSISTED_SERVICE_PORT/api/assisted-install/v1/clusters/$CLUSTER_ID/hosts/$HOST_ID/installer-args&quot;
</code></pre>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/openshift/assisted-service" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
